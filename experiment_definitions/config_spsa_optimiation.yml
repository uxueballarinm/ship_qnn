# -----------------------------------------------------------------------------
# EXPERIMENT 1: The "Corrected" 3-Head Model
# Hypothesis: Fixing the missing physics inputs (Rudder in Yaw, YawRate in Surge)
# will solve the lag without changing the architecture.
# -----------------------------------------------------------------------------
- window_size: 5
  data: reduce_dataset_cobyla
  select_features: ['wv', 'sv', 'yr', 'ya', 'rarad']
  model: multihead
  predict: motion
  optimizer: spsa
  maxiter: 15000       # High iterations for SPSA
  batch_size: 64       # Stability
  learning_rate: 0.002 # Stability
  perturbation: 0.1
  # Weights: Heavy penalty on Surge (5.0) to force learning
  weights: [5.0, 1.0, 1.0, 1.0] 
  run: [0]

  heads_config:
    # Head 1: Surge (Added 'yr' because turning slows the ship down)
    - features: ['wv', 'sv', 'yr', 'rarad'] 
      output_dim: 1  # Target: Surge
      reps: 3
      encoding: compact
      ansatz: efficientsu2
      entangle: full
      map: [0, 1, 2, 3,-1,-1]

    # Head 2: Sway (Standard)
    - features: ['sv', 'yr', 'rarad']
      output_dim: 2  # Target: Sway
      reps: 3
      encoding: compact
      ansatz: efficientsu2
      entangle: full
      map: [0, 1, 2]

    # Head 3: Yaw (Added 'rarad' to anticipate turning acceleration)
    - features: ['ya', 'yr', 'rarad']
      output_dim: 1  # Target: Yaw Angle
      reps: 1
      encoding: compact
      ansatz: realamplitudes
      entangle: full
      map: [0, 1, 2]


# -----------------------------------------------------------------------------
# EXPERIMENT 2: The "Merged" 2-Head Model (Fewer Heads)
# Hypothesis: Merging Sway/Yaw allows entanglement to model the 
# Drift-Turn coupling better than separate heads.
# -----------------------------------------------------------------------------
- window_size: 5
  data: reduce_dataset_cobyla
  select_features: ['wv', 'sv', 'yr', 'ya', 'rarad']
  model: multihead
  predict: motion
  optimizer: spsa
  maxiter: 15000
  batch_size: 64
  learning_rate: 0.002
  perturbation: 0.1
  weights: [5.0, 1.0, 1.0, 1.0]
  run: [0]

  heads_config:
    # Head 1: Longitudinal Dynamics (Surge is mostly independent)
    - features: ['wv', 'sv', 'yr', 'rarad']
      output_dim: 1  # Target: Surge
      reps: 3
      encoding: compact
      ansatz: efficientsu2
      entangle: full
      map: [0, 1, 2, 3,-1,-1]

    # Head 2: Lateral Dynamics (Merged Sway + Yaw Rate + Yaw Angle)
    # This head outputs 3 values!
    - features: ['sv', 'yr', 'ya', 'rarad'] 
      output_dim: 3  # Targets: Sway, Yaw Rate, Yaw Angle
      reps: 4        # Increased depth slightly to handle complex coupled physics
      encoding: compact
      ansatz: efficientsu2
      entangle: full
      map: [0, 1, 2, 3,-1,-1]

# -----------------------------------------------------------------------------
# EXPERIMENT 3: Merged 2-Head + Circular Entanglement
# Hypothesis: Circular entanglement is often better for closed-loop stability 
# and periodic variables (Angles) than Full/Linear.
# -----------------------------------------------------------------------------
- window_size: 5
  data: reduce_dataset_cobyla
  select_features: ['wv', 'sv', 'yr', 'ya', 'rarad']
  model: multihead
  predict: motion
  optimizer: spsa
  maxiter: 15000
  batch_size: 64
  learning_rate: 0.002
  perturbation: 0.1
  weights: [5.0, 1.0, 1.0, 1.0]
  run: [0]

  heads_config:
    - features: ['wv', 'sv', 'yr', 'rarad']
      output_dim: 1
      reps: 3
      encoding: compact
      ansatz: efficientsu2
      entangle: circular # <--- Circular
      map: [0, 1, 2, 3,-1,-1]

    - features: ['sv', 'yr', 'ya', 'rarad']
      output_dim: 3
      reps: 4
      encoding: compact
      ansatz: efficientsu2
      entangle: circular # <--- Circular
      map: [0, 1, 2, 3,-1,-1]